[2025-10-05 04:33:13,879][root][INFO] - Configuration: experiment:
  data_path: ../data
  checkpoint_dir: ../checkpoints
  models:
  - 'inf'
  row_fraction: 1.0
  num_targets: 424
  filter_features: false
  optuna:
    direction: minimize
    n_trials: 2
    n_jobs: 2
model:
  model_type: default
  model_class: default
  trainer_class: default
  params:
    input_size: 1672
    output_size: 424
    input_len: 64
    output_len: 5
    batch_size: 16
    hidden_size: 128
    num_layers: 2
    dropout: 0.1
    epochs: 10
    patience: 5
    channels: 64
    blocks: 3
    kernel_size: 5
    num_conv_layers: 2
    tcn_kernel: 3
    decom_kernel_size: 25
    top_k_modes: 5
    nhead: 8
    dim_feedforward: 512
    weight_decay: 0.001
    scheduler_patience: 5
    scheduler_factor: 0.5
    clip_grad_norm: 1.0
    partially_finite_target: false
  lr: 0.001
  optimizer: AdamW
  lr_policy: constant

[2025-10-05 04:33:13,881][root][INFO] - Set random seed to 42 for reproducibility.
[2025-10-05 04:33:13,881][root][INFO] - CUDA version: 12.1
[2025-10-05 04:33:13,917][root][INFO] - Device count: 1
[2025-10-05 04:33:13,919][root][INFO] - Device name: NVIDIA GeForce RTX 4060 Laptop GPU
[2025-10-05 04:33:14,020][root][INFO] - Loading train.csv from ../data/train.csv
[2025-10-05 04:33:14,096][root][INFO] - Loading train_labels.csv from ../data/train_labels.csv
[2025-10-05 04:33:14,214][root][INFO] - Loading target_pairs.csv from ../data/target_pairs.csv
[2025-10-05 04:33:14,353][root][INFO] - X_full NaNs after imputation: 0
[2025-10-05 04:33:14,354][root][INFO] - Y_full NaNs before imputation: 0
[2025-10-05 04:33:14,355][root][INFO] - Y_full NaNs after imputation: 0
[2025-10-05 04:33:14,355][root][INFO] - X_full feature count: 1671
[2025-10-05 04:33:14,365][root][INFO] - Data loaded: X_full_np shape=(1917, 1671), Y_full_np shape=(1917, 424)
[2025-10-05 04:33:14,365][root][INFO] - Raw data shapes: X=(1917, 1671), Y=(1917, 424)
[2025-10-05 04:33:14,365][root][INFO] - Sample batch shapes: X=(64, 1671), Y=(64, 424)
[2025-10-05 04:33:14,793][root][INFO] - Trial 10 started with params: {'input_size': 1671, 'output_size': 424, 'output_len': 5, 'input_len': 32, 'label_len': 16, 'hidden_size': 256, 'num_layers': 2, 'd_layers': 1, 'nhead': 8, 'dim_feedforward': 1024, 'dropout': 0.3, 'batch_size': 64, 'attn': 'prob', 'distil': True, 'mix': True}, lr=1.2571676406848938e-05, optimizer=AdamW, lr_policy=clr
[2025-10-05 04:33:15,078][root][INFO] - Performed memory cleaning.
[2025-10-05 04:33:15,195][root][INFO] - Trial 11 started with params: {'input_size': 1671, 'output_size': 424, 'output_len': 5, 'input_len': 64, 'label_len': 32, 'hidden_size': 256, 'num_layers': 4, 'd_layers': 2, 'nhead': 8, 'dim_feedforward': 1024, 'dropout': 0.2, 'batch_size': 64, 'attn': 'prob', 'distil': True, 'mix': True}, lr=1.0635027866929412e-05, optimizer=Adam, lr_policy=constant
[2025-10-05 04:33:15,471][root][INFO] - GPU Memory: 1.06 GB used out of 8.00 GB
[2025-10-05 04:33:15,471][root][INFO] - Performed memory cleaning.
[2025-10-05 04:33:15,472][root][INFO] - GPU Memory: 1.06 GB used out of 8.00 GB
[2025-10-05 04:33:15,475][root][INFO] - Trial 11: X_raw shape=(1917, 1671), Y_raw shape=(1917, 424), NaNs X=0, Y=0
[2025-10-05 04:33:15,475][root][INFO] - Building Informer datasets with input_len=64, output_len=5, label_len=32, use_time_feats=True
[2025-10-05 04:33:15,476][root][INFO] - Trial 10: X_raw shape=(1917, 1671), Y_raw shape=(1917, 424), NaNs X=0, Y=0
[2025-10-05 04:33:15,476][root][INFO] - Building Informer datasets with input_len=32, output_len=5, label_len=16, use_time_feats=True
[2025-10-05 04:33:15,745][root][INFO] - WindowDataset created: Xw shape=(1881, 32, 1671), Yw shape=(1881, 5, 424), invalid_windows: 0
[2025-10-05 04:33:16,295][root][INFO] - WindowDataset created: Xw shape=(1849, 64, 1671), Yw shape=(1849, 5, 424), invalid_windows: 0
[2025-10-05 04:33:18,537][root][INFO] - InformerWindowDataset created: Xw shape=(1881, 32, 1671), x_dec shape=(1881, 21, 424), Yw shape=(1881, 5, 424), mark_enc shape=(1881, 32, 256), invalid_windows=0
[2025-10-05 04:33:18,541][root][INFO] - Informer dataset created: X_enc shape=(1881, 32, 1671), x_dec shape=(1881, 21, 424), Y shape=(1881, 5, 424), mark_enc shape=(1881, 32, 256)
[2025-10-05 04:33:18,678][root][INFO] - Informer DataLoaders created: train=1411, val=282, test=188
[2025-10-05 04:33:18,680][root][INFO] - Trial 10: Creating InTrainer with device=cuda
[2025-10-05 04:33:18,680][root][INFO] - InTrainer initialized with model_kwargs: {'input_size': 1671, 'enc_in': 1671, 'dec_in': 424, 'c_out': 424, 'seq_len': 32, 'label_len': 16, 'out_len': 5, 'd_model': 256, 'n_heads': 8, 'e_layers': 2, 'd_layers': 1, 'd_ff': 1024, 'dropout': 0.3, 'attn': 'prob', 'embed': 'fixed', 'freq': 'd', 'activation': 'gelu', 'distil': True, 'mix': True, 'device': 'cuda'}
[2025-10-05 04:33:18,822][root][INFO] - Trainer initialized with device=cpu
[2025-10-05 04:33:19,133][root][ERROR] - Trial 10 failed: The size of tensor a (320) must match the size of tensor b (64) at non-singleton dimension 0
Traceback (most recent call last):
  File "/root/vscode/portfolio/mitsui_2025/src/study.py", line 202, in objective_informer
    val_loss = trainer.train(train_loader=train_loader, val_loader=val_loader)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/trainer.py", line 675, in train
    loss = self.masked_mse(pred, y) if self.cfg.partially_finite_target else nn.MSELoss()(pred, y)
                                                                             ^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/loss.py", line 608, in forward
    return F.mse_loss(input, target, reduction=self.reduction)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/functional.py", line 3791, in mse_loss
    expanded_input, expanded_target = torch.broadcast_tensors(input, target)
                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/functional.py", line 76, in broadcast_tensors
    return _VF.broadcast_tensors(tensors)  # type: ignore[attr-defined]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: The size of tensor a (320) must match the size of tensor b (64) at non-singleton dimension 0

[2025-10-05 04:33:19,419][root][INFO] - GPU Memory: 1.06 GB used out of 8.00 GB
[2025-10-05 04:33:19,682][root][INFO] - Performed memory cleaning.
[2025-10-05 04:33:19,899][root][INFO] - InformerWindowDataset created: Xw shape=(1849, 64, 1671), x_dec shape=(1849, 37, 424), Yw shape=(1849, 5, 424), mark_enc shape=(1849, 64, 256), invalid_windows=0
[2025-10-05 04:33:19,907][root][INFO] - Informer dataset created: X_enc shape=(1849, 64, 1671), x_dec shape=(1849, 37, 424), Y shape=(1849, 5, 424), mark_enc shape=(1849, 64, 256)
[2025-10-05 04:33:20,132][root][INFO] - Informer DataLoaders created: train=1388, val=277, test=184
[2025-10-05 04:33:20,133][root][INFO] - Trial 11: Creating InTrainer with device=cuda
[2025-10-05 04:33:20,133][root][INFO] - InTrainer initialized with model_kwargs: {'input_size': 1671, 'enc_in': 1671, 'dec_in': 424, 'c_out': 424, 'seq_len': 64, 'label_len': 32, 'out_len': 5, 'd_model': 256, 'n_heads': 8, 'e_layers': 4, 'd_layers': 2, 'd_ff': 1024, 'dropout': 0.2, 'attn': 'prob', 'embed': 'fixed', 'freq': 'd', 'activation': 'gelu', 'distil': True, 'mix': True, 'device': 'cuda'}
[2025-10-05 04:33:20,204][root][INFO] - Trainer initialized with device=cpu
[2025-10-05 04:33:20,357][root][ERROR] - Trial 11 failed: index 58 is out of bounds for dimension 2 with size 50
Traceback (most recent call last):
  File "/root/vscode/portfolio/mitsui_2025/src/study.py", line 202, in objective_informer
    val_loss = trainer.train(train_loader=train_loader, val_loader=val_loader)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/trainer.py", line 673, in train
    pred = self.model(x_enc, x_mark_enc=x_mark_enc, x_dec=x_dec, x_mark_dec=x_mark_dec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1561, in forward
    enc_out, attns = self.encoder(enc_out, attn_mask=enc_self_mask)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1379, in forward
    x, attn = attn_layer(x, attn_mask=attn_mask)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1361, in forward
    new_x, attn = self.attention(x, x, x, attn_mask=attn_mask)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1342, in forward
    out, attn = self.inner_attention(queries, keys, values, attn_mask)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/anaconda3/envs/mitsui/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1315, in forward
    context, attn = self._update_context(context, values, scores_top, index, u, attn_mask)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/vscode/portfolio/mitsui_2025/src/models.py", line 1291, in _update_context
    context_in[torch.arange(B)[:, None, None], torch.arange(H)[None, :, None], index, :] = torch.matmul(attn, V).type_as(context_in)
    ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
IndexError: index 58 is out of bounds for dimension 2 with size 50

[2025-10-05 04:33:20,696][root][INFO] - GPU Memory: 1.06 GB used out of 8.00 GB
[2025-10-05 04:33:20,992][root][INFO] - Performed memory cleaning.
[2025-10-05 04:33:21,012][root][WARNING] - No completed trials for INF. All trials were pruned or failed. Trials: 12
[2025-10-05 04:33:21,014][root][INFO] - Trial states: [3, 3, 3, 3, 2, 2, 3, 3, 2, 2, 2, 2]
